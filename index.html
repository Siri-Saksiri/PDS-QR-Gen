<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Code Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      background: #1e1e1e;
      padding: 20px 30px;
      border-radius: 16px;
      width: 400px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      outline: none;
      background: #333;
      color: #fff;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background: #3e7cb1;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #559fd2;
    }

    #links-container {
      margin: 10px 0;
      max-height: 200px;
      overflow-y: auto;
    }

    img {
      display: block;
      margin: 15px auto;
      border-radius: 8px;
      background: white;
      max-width: 100%;
    }

    h2 {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>QR Code Generator</h2>

    <input type="number" id="quantity" min="1" max="100" value="1" placeholder="How many QR codes?" />
    <input type="text" id="size" value="400x400" placeholder="Image size (e.g. 400x400)" />

    <div id="links-container"></div>

    <button id="preview-btn">Generate Preview (First QR)</button>
    <img id="preview" src="" alt="QR Preview" style="display:none;" />
    <button id="export-btn" disabled>Export All QR Codes</button>
  </div>

  <script>
    const quantityInput = document.getElementById('quantity');
    const sizeInput = document.getElementById('size');
    const linksContainer = document.getElementById('links-container');
    const previewBtn = document.getElementById('preview-btn');
    const exportBtn = document.getElementById('export-btn');
    const previewImg = document.getElementById('preview');

    function updateLinks() {
      linksContainer.innerHTML = '';
      const count = parseInt(quantityInput.value) || 1;
      for (let i = 0; i < count; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `Link for QR #${i + 1}`;
        input.className = 'qr-link';
        linksContainer.appendChild(input);
      }
      exportBtn.disabled = count < 1;
    }

    quantityInput.addEventListener('input', updateLinks);
    updateLinks();

    previewBtn.addEventListener('click', () => {
      const size = sizeInput.value.trim();
      const firstLink = document.querySelector('.qr-link')?.value.trim();
      if (!firstLink) {
        alert("First QR code link is empty!");
        return;
      }
      if (!size.includes('x')) {
        alert("Size must be in format WIDTHxHEIGHT (e.g. 400x400).");
        return;
      }
      const url = `https://api.qrserver.com/v1/create-qr-code/?size=${size}&data=${encodeURIComponent(firstLink)}`;
      previewImg.src = url;
      previewImg.style.display = 'block';
    });

    exportBtn.addEventListener('click', async () => {
      const size = sizeInput.value.trim();
      const links = Array.from(document.querySelectorAll('.qr-link')).map(l => l.value.trim()).filter(Boolean);
      if (links.length === 0) {
        alert("Please fill in all QR data fields.");
        return;
      }

      const zip = new JSZip();
      for (let i = 0; i < links.length; i++) {
        const link = links[i];
        const url = `https://api.qrserver.com/v1/create-qr-code/?size=${size}&data=${encodeURIComponent(link)}`;
        const blob = await fetch(url).then(res => res.blob());
        zip.file(`qr_${i + 1}.png`, blob);
      }

      const blobZip = await zip.generateAsync({ type: 'blob' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blobZip);
      link.download = 'QR_Codes.zip';
      link.click();
      URL.revokeObjectURL(link.href);
    });

    // Load JSZip dynamically
    const jszipScript = document.createElement('script');
    jszipScript.src = "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js";
    document.body.appendChild(jszipScript);
  </script>
</body>
</html>
